{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useCovidGdpApiData.js\nimport { useEffect, useState } from \"react\";\n\n// Map dashboard country codes → pomber COVID label\nconst COVID_COUNTRY_MAP = {\n  US: \"US\",\n  DE: \"Germany\",\n  IT: \"Italy\",\n  JP: \"Japan\",\n  CA: \"Canada\",\n  FR: \"France\"\n};\n\n// Map dashboard country codes → TradingEconomics country names\n// (matching TE's expected \"country\" parameter)\nconst TE_COUNTRY_MAP = {\n  US: \"united states\",\n  DE: \"germany\",\n  IT: \"italy\",\n  JP: \"japan\",\n  CA: \"canada\",\n  FR: \"france\"\n};\n\n// Helper: compute growth % series from value series\nfunction computeGrowthSeries(values) {\n  return values.map((point, idx, arr) => {\n    if (idx === 0) {\n      return {\n        ...point,\n        growth: null\n      };\n    }\n    const prev = arr[idx - 1].value;\n    const growth = prev === 0 || prev == null ? null : (point.value - prev) / prev * 100;\n    return {\n      ...point,\n      growth\n    };\n  });\n}\n\n/**\n * Hook: fetch COVID daily data (pombér) + GDP from TradingEconomics\n * and join them by date.\n */\nexport function useCovidGdpApiData(countryKey) {\n  _s();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [covidDaily, setCovidDaily] = useState([]);\n  const [gdpSeries, setGdpSeries] = useState([]);\n  const [combined, setCombined] = useState([]);\n  const covidKey = COVID_COUNTRY_MAP[countryKey] || countryKey;\n  const teCountry = TE_COUNTRY_MAP[countryKey] || \"united states\";\n  const teApiKey = process.env.REACT_APP_TE_API_KEY;\n  useEffect(() => {\n    async function fetchData() {\n      setLoading(true);\n      setError(null);\n      try {\n        if (!teApiKey) {\n          throw new Error(\"Missing REACT_APP_TE_API_KEY in .env for TradingEconomics\");\n        }\n\n        //\n        // 1. COVID daily data (pomber)\n        //\n        const covidRes = await fetch(\"https://pomber.github.io/covid19/timeseries.json\");\n        if (!covidRes.ok) {\n          throw new Error(\"COVID API request failed\");\n        }\n        const covidJson = await covidRes.json();\n        const series = covidJson[covidKey];\n        if (!series) {\n          throw new Error(`No COVID data for country: ${covidKey}`);\n        }\n        const covidWithNew = series.map((row, idx) => {\n          const prevConfirmed = idx > 0 ? series[idx - 1].confirmed : 0;\n          const newCases = row.confirmed - prevConfirmed;\n          return {\n            date: row.date,\n            // YYYY-MM-DD\n            confirmed: row.confirmed,\n            deaths: row.deaths,\n            recovered: row.recovered,\n            newCases: newCases < 0 ? 0 : newCases\n          };\n        });\n\n        //\n        // 2. GDP data from TradingEconomics (front-end direct)\n        //\n        // Docs: /historical/country/{country}/indicator/gdp?c=KEY\n        // We’ll treat the value as GDP level and compute growth ourselves.\n        //\n        const teBase = \"https://api.tradingeconomics.com\";\n        const teUrl = `${teBase}/historical/country/${encodeURIComponent(teCountry)}/indicator/gdp?c=${encodeURIComponent(teApiKey)}`;\n        const gdpRes = await fetch(teUrl);\n        if (!gdpRes.ok) {\n          const text = await gdpRes.text();\n          throw new Error(`TradingEconomics GDP request failed (${gdpRes.status}): ${text || \"no body\"}`);\n        }\n        const teData = await gdpRes.json();\n        // TradingEconomics usually returns an array of objects with fields like:\n        // { Date: \"2022-01-01T00:00:00\", Value: 12345, ... }\n        const gdpRaw = Array.isArray(teData) ? teData : [];\n        const gdpValues = gdpRaw.filter(row => row.Value != null).map(row => ({\n          date: row.Date ? row.Date.substring(0, 10) : null,\n          // YYYY-MM-DD\n          value: Number(row.Value)\n        })).filter(row => row.date != null);\n\n        // Sort by date just in case\n        gdpValues.sort((a, b) => a.date < b.date ? -1 : a.date > b.date ? 1 : 0);\n        const gdpWithGrowth = computeGrowthSeries(gdpValues);\n\n        //\n        // 3. Join GDP growth to daily COVID dates (step-like)\n        //\n        let j = 0;\n        const joined = covidWithNew.map(day => {\n          const dayDate = day.date;\n          while (j + 1 < gdpWithGrowth.length && gdpWithGrowth[j + 1].date <= dayDate) {\n            j++;\n          }\n          const gdpForDay = gdpWithGrowth[j] || null;\n          return {\n            date: day.date,\n            newCases: day.newCases,\n            confirmed: day.confirmed,\n            deaths: day.deaths,\n            gdpGrowth: gdpForDay ? gdpForDay.growth : null\n          };\n        });\n        setCovidDaily(covidWithNew);\n        setGdpSeries(gdpWithGrowth);\n        setCombined(joined);\n        setLoading(false);\n      } catch (err) {\n        console.error(\"useCovidGdpApiData error:\", err);\n        setError(err);\n        setLoading(false);\n      }\n    }\n    if (countryKey) {\n      fetchData();\n    }\n  }, [countryKey, covidKey, teCountry, teApiKey]);\n  return {\n    loading,\n    error,\n    covidDaily,\n    gdpSeries,\n    combined\n  };\n}\n_s(useCovidGdpApiData, \"QSABJevVDZQIcSWzB2W5w0ZfyAM=\");","map":{"version":3,"names":["useEffect","useState","COVID_COUNTRY_MAP","US","DE","IT","JP","CA","FR","TE_COUNTRY_MAP","computeGrowthSeries","values","map","point","idx","arr","growth","prev","value","useCovidGdpApiData","countryKey","_s","loading","setLoading","error","setError","covidDaily","setCovidDaily","gdpSeries","setGdpSeries","combined","setCombined","covidKey","teCountry","teApiKey","process","env","REACT_APP_TE_API_KEY","fetchData","Error","covidRes","fetch","ok","covidJson","json","series","covidWithNew","row","prevConfirmed","confirmed","newCases","date","deaths","recovered","teBase","teUrl","encodeURIComponent","gdpRes","text","status","teData","gdpRaw","Array","isArray","gdpValues","filter","Value","Date","substring","Number","sort","a","b","gdpWithGrowth","j","joined","day","dayDate","length","gdpForDay","gdpGrowth","err","console"],"sources":["/Users/trakoolthai/Desktop/front-end-final-project/src/hooks/useCovidGdpApiData.js"],"sourcesContent":["// src/hooks/useCovidGdpApiData.js\nimport { useEffect, useState } from \"react\";\n\n// Map dashboard country codes → pomber COVID label\nconst COVID_COUNTRY_MAP = {\n    US: \"US\",\n    DE: \"Germany\",\n    IT: \"Italy\",\n    JP: \"Japan\",\n    CA: \"Canada\",\n    FR: \"France\",\n};\n\n// Map dashboard country codes → TradingEconomics country names\n// (matching TE's expected \"country\" parameter)\nconst TE_COUNTRY_MAP = {\n    US: \"united states\",\n    DE: \"germany\",\n    IT: \"italy\",\n    JP: \"japan\",\n    CA: \"canada\",\n    FR: \"france\",\n};\n\n// Helper: compute growth % series from value series\nfunction computeGrowthSeries(values) {\n    return values.map((point, idx, arr) => {\n        if (idx === 0) {\n            return { ...point, growth: null };\n        }\n        const prev = arr[idx - 1].value;\n        const growth =\n            prev === 0 || prev == null\n                ? null\n                : ((point.value - prev) / prev) * 100;\n        return { ...point, growth };\n    });\n}\n\n/**\n * Hook: fetch COVID daily data (pombér) + GDP from TradingEconomics\n * and join them by date.\n */\nexport function useCovidGdpApiData(countryKey) {\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    const [covidDaily, setCovidDaily] = useState([]);\n    const [gdpSeries, setGdpSeries] = useState([]);\n    const [combined, setCombined] = useState([]);\n\n    const covidKey = COVID_COUNTRY_MAP[countryKey] || countryKey;\n    const teCountry = TE_COUNTRY_MAP[countryKey] || \"united states\";\n    const teApiKey = process.env.REACT_APP_TE_API_KEY;\n\n    useEffect(() => {\n        async function fetchData() {\n            setLoading(true);\n            setError(null);\n\n            try {\n                if (!teApiKey) {\n                    throw new Error(\n                        \"Missing REACT_APP_TE_API_KEY in .env for TradingEconomics\"\n                    );\n                }\n\n                //\n                // 1. COVID daily data (pomber)\n                //\n                const covidRes = await fetch(\n                    \"https://pomber.github.io/covid19/timeseries.json\"\n                );\n                if (!covidRes.ok) {\n                    throw new Error(\"COVID API request failed\");\n                }\n                const covidJson = await covidRes.json();\n                const series = covidJson[covidKey];\n                if (!series) {\n                    throw new Error(`No COVID data for country: ${covidKey}`);\n                }\n\n                const covidWithNew = series.map((row, idx) => {\n                    const prevConfirmed =\n                        idx > 0 ? series[idx - 1].confirmed : 0;\n                    const newCases = row.confirmed - prevConfirmed;\n                    return {\n                        date: row.date, // YYYY-MM-DD\n                        confirmed: row.confirmed,\n                        deaths: row.deaths,\n                        recovered: row.recovered,\n                        newCases: newCases < 0 ? 0 : newCases,\n                    };\n                });\n\n                //\n                // 2. GDP data from TradingEconomics (front-end direct)\n                //\n                // Docs: /historical/country/{country}/indicator/gdp?c=KEY\n                // We’ll treat the value as GDP level and compute growth ourselves.\n                //\n                const teBase = \"https://api.tradingeconomics.com\";\n                const teUrl = `${teBase}/historical/country/${encodeURIComponent(\n                    teCountry\n                )}/indicator/gdp?c=${encodeURIComponent(teApiKey)}`;\n\n                const gdpRes = await fetch(teUrl);\n                if (!gdpRes.ok) {\n                    const text = await gdpRes.text();\n                    throw new Error(\n                        `TradingEconomics GDP request failed (${\n                            gdpRes.status\n                        }): ${text || \"no body\"}`\n                    );\n                }\n\n                const teData = await gdpRes.json();\n                // TradingEconomics usually returns an array of objects with fields like:\n                // { Date: \"2022-01-01T00:00:00\", Value: 12345, ... }\n                const gdpRaw = Array.isArray(teData) ? teData : [];\n\n                const gdpValues = gdpRaw\n                    .filter((row) => row.Value != null)\n                    .map((row) => ({\n                        date: row.Date ? row.Date.substring(0, 10) : null, // YYYY-MM-DD\n                        value: Number(row.Value),\n                    }))\n                    .filter((row) => row.date != null);\n\n                // Sort by date just in case\n                gdpValues.sort((a, b) =>\n                    a.date < b.date ? -1 : a.date > b.date ? 1 : 0\n                );\n\n                const gdpWithGrowth = computeGrowthSeries(gdpValues);\n\n                //\n                // 3. Join GDP growth to daily COVID dates (step-like)\n                //\n                let j = 0;\n                const joined = covidWithNew.map((day) => {\n                    const dayDate = day.date;\n\n                    while (\n                        j + 1 < gdpWithGrowth.length &&\n                        gdpWithGrowth[j + 1].date <= dayDate\n                    ) {\n                        j++;\n                    }\n                    const gdpForDay = gdpWithGrowth[j] || null;\n\n                    return {\n                        date: day.date,\n                        newCases: day.newCases,\n                        confirmed: day.confirmed,\n                        deaths: day.deaths,\n                        gdpGrowth: gdpForDay ? gdpForDay.growth : null,\n                    };\n                });\n\n                setCovidDaily(covidWithNew);\n                setGdpSeries(gdpWithGrowth);\n                setCombined(joined);\n                setLoading(false);\n            } catch (err) {\n                console.error(\"useCovidGdpApiData error:\", err);\n                setError(err);\n                setLoading(false);\n            }\n        }\n\n        if (countryKey) {\n            fetchData();\n        }\n    }, [countryKey, covidKey, teCountry, teApiKey]);\n\n    return { loading, error, covidDaily, gdpSeries, combined };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}